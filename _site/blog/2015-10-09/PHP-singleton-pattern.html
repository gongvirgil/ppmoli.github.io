<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PHP设计模式之单例模式 | site of gongvirgil</title>
    <meta name="author" content="gongvirgil" />
    <meta name="renderer" content="webkit">
    <meta name="description" content="gongvirgil's Blog" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <link rel="shortcut icon" href="/public/images/favicon.ico" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/atom.xml" />
    <link rel="stylesheet" href="/public/font-awesome-4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/public/css/default.css">
    <link rel="stylesheet" href="/public/scroll/jquery.mCustomScrollbar.css">
    <script type="text/javascript" src="/public/js/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="/public/scroll/jquery.mCustomScrollbar.concat.min.js"></script>
    <script type="text/javascript" src="/public/js/default.js"></script>
  </head>
  <body>
    <!--
    <header id="home">
      <div class="navbar navbar-fixed-top">
        <div class="container">
            <div class="logo">
              <a href="/"><img src="/public/images/a.png" alt="GongVirgil" /></a>
            </div>
            <div class="menu">
              <a id="side-bar-btn"><i class="fa fa-navicon"></i></a>
            </div>
        </div>
      </div>
      <div class="header-content-wrap">
        <div class="container">
          
        </div>
      </div>
    </header>

    <div class="notice"></div>
    <div class="shadow-screen"></div>
    <div class="side-bar">
      <a id="side-bar-close-btn"><i class="fa fa-times"></i></a>
              <div id="menu-pages">
          <li><a href="/">HOME</a></li>
          <li><a href="/archive.html">ALL POSTS</a></li>
          <li><a href="/contact.html">CONTACT ME</a></li>
        </div>
        <div id="category">
            <h4>CATEGORY</h4>
            <div class="list-content">
              
              <li><a href="/category.html?CATE=技术">技术<span class="cate-size">24</span></a></li>
              
              <li><a href="/category.html?CATE=生活">生活<span class="cate-size">1</span></a></li>
              
            </div>
            <div class="clear"></div>
        </div>
        <div id="tag">
            <h4>TAGS</h4>
            <div  class="tag-cloud">
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=html" title="1" style="font-size: 9.5pt; color: #999;">html</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=笔记" title="11" style="font-size: 12pt; color: #666;">笔记</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=jquery" title="1" style="font-size: 9.5pt; color: #999;">jquery</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=js" title="1" style="font-size: 9.5pt; color: #999;">js</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=Linux" title="1" style="font-size: 9.5pt; color: #999;">Linux</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=php" title="1" style="font-size: 9.5pt; color: #999;">php</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=css" title="2" style="font-size: 9.5pt; color: #888;">css</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=软件" title="1" style="font-size: 9.5pt; color: #999;">软件</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=Github" title="1" style="font-size: 9.5pt; color: #999;">Github</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=Blog" title="2" style="font-size: 9.5pt; color: #888;">Blog</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=Jekyll" title="1" style="font-size: 9.5pt; color: #999;">Jekyll</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=markdown" title="1" style="font-size: 9.5pt; color: #999;">markdown</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=page" title="1" style="font-size: 9.5pt; color: #999;">page</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=CSS" title="2" style="font-size: 9.5pt; color: #888;">CSS</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=sublime" title="1" style="font-size: 9.5pt; color: #999;">sublime</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=work" title="1" style="font-size: 9.5pt; color: #999;">work</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=code" title="1" style="font-size: 9.5pt; color: #999;">code</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=soft" title="1" style="font-size: 9.5pt; color: #999;">soft</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=购物" title="1" style="font-size: 9.5pt; color: #999;">购物</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=品牌" title="1" style="font-size: 9.5pt; color: #999;">品牌</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=日用品" title="1" style="font-size: 9.5pt; color: #999;">日用品</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=ThinkPHP" title="1" style="font-size: 9.5pt; color: #999;">ThinkPHP</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=linux" title="5" style="font-size: 10.5pt; color: #888;">linux</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=bootstrap" title="1" style="font-size: 9.5pt; color: #999;">bootstrap</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=vi" title="1" style="font-size: 9.5pt; color: #999;">vi</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=git" title="1" style="font-size: 9.5pt; color: #999;">git</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=laravel" title="2" style="font-size: 9.5pt; color: #888;">laravel</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=随笔" title="1" style="font-size: 9.5pt; color: #999;">随笔</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=任务" title="1" style="font-size: 9.5pt; color: #999;">任务</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=PHPExcel" title="1" style="font-size: 9.5pt; color: #999;">PHPExcel</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=Excel" title="1" style="font-size: 9.5pt; color: #999;">Excel</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=PHP" title="3" style="font-size: 10pt; color: #888;">PHP</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=单例模式" title="1" style="font-size: 9.5pt; color: #999;">单例模式</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=firefox" title="1" style="font-size: 9.5pt; color: #999;">firefox</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=插件" title="1" style="font-size: 9.5pt; color: #999;">插件</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=域名" title="1" style="font-size: 9.5pt; color: #999;">域名</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=重定向" title="1" style="font-size: 9.5pt; color: #999;">重定向</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=函数" title="1" style="font-size: 9.5pt; color: #999;">函数</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=mobile" title="1" style="font-size: 9.5pt; color: #999;">mobile</a>
                
                  
                  
                  
                  
                    
                  
                  
                    
                  
                  <a href="/tag.html?TAG=jQuery" title="1" style="font-size: 9.5pt; color: #999;">jQuery</a>
                
            </div>
            <div class="clear"></div>
        </div>



    </div>
    -->
    <header class="header">
      <div class="avatar">
        <img width="80" height="80" src="/public/images/me.png" class="circle">
        <a title="Virgil's Blog" href="/"><h2>Virgil's Blog</h2></a>
      </div>   
      <div class="links">
        <a title="返回主页" href="/"><i class="fa fa-home"></i></a>
        <a title="返回主页" href="/"><i class="fa fa-home"></i></a>
        <a title="返回主页" href="/"><i class="fa fa-home"></i></a>
        <a title="返回主页" href="/"><i class="fa fa-home"></i></a>
        <a title="返回主页" href="/"><i class="fa fa-home"></i></a>
      </div> 
      <div class="calculates">  
        <div class="calculate-item">
          <a href="/archive.html"><span class="calculate-item-count">31</span><span class="calculate-item-name">归档</span></a>
        </div>
        <div class="calculate-item">
          <a href="/category.html"><span class="calculate-item-count">2</span><span class="calculate-item-name">分类</span></a>
        </div>
        <div class="calculate-item">
          <a href="/tag.html"><span class="calculate-item-count">40</span><span class="calculate-item-name">标签</span></a>
        </div>
      </div>
    </header>
    <!--Main-->
    <div class="main">
      <div class="main-content">
            <link rel="stylesheet" type="text/css" href="/public/css/post.css">
    <link rel="stylesheet" type="text/css" href="/public/css/prettify.css">
    <!-- <link rel="stylesheet" type="text/css" href="/public/css/poole.css"> -->
    <div class="post-main">
        <div id="content">
            <div class="post">
                <div class="post_title">
                    <h1><a href="/blog/2015-10-09/PHP-singleton-pattern.html" title="PHP设计模式之单例模式">PHP设计模式之单例模式</a></h1>
                </div>
                <div class="post_relate">
                    <span class="post_date">2015-10-09</span>
                    <span class="post_tags">
                        
                            <a href="/tags/?tag=PHP" title="PHP">PHP</a>
                        
                            <a href="/tags/?tag=单例模式" title="单例模式">单例模式</a>
                        
                    </span>
                </div>
                <div class="post_content">
                    <p>单例模式（职责模式）：</p>

<p>简单的说，一个对象（在学习设计模式之前，需要比较了解面向对象思想）只负责一个特定的任务；</p>

<p>单例类：</p>

<p>1、构造函数需要标记为private（访问控制：防止外部代码使用new操作符创建对象），单例类不能在其他类中实例化，只能被其自身实例化；</p>

<p>2、拥有一个保存类的实例的静态成员变量</p>

<p>3、拥有一个访问这个实例的公共的静态方法（常用getInstance()方法进行实例化单例类，通过instanceof操作符可以检测到类是否已经被实例化）</p>

<p>另外，需要创建__clone()方法防止对象被复制（克隆）</p>

<p>为什么要使用PHP单例模式？</p>

<p>1、php的应用主要在于数据库应用, 所以一个应用中会存在大量的数据库操作, 使用单例模式, 则可以避免大量的new 操作消耗的资源。</p>

<p>2、如果系统中需要有一个类来全局控制某些配置信息, 那么使用单例模式可以很方便的实现. 这个可以参看ZF的FrontController部分。</p>

<p>3、在一次页面请求中, 便于进行调试, 因为所有的代码(例如数据库操作类db)都集中在一个类中, 我们可以在类中设置钩子, 输出日志，从而避免到处var_dump, echo。</p>

<p>代码实现：</p>

<pre><code>&lt;?php

/*

* 设计模式之单例模式

* $_instance必须声明为静态的私有变量

* 构造函数和析构函数必须声明为私有,防止外部程序new

* 类从而失去单例模式的意义

* getInstance()方法必须设置为公有的,必须调用此方法

* 以返回实例的一个引用

* ::操作符只能访问静态变量和静态函数

* new对象都会消耗内存

* 使用场景:最常用的地方是数据库连接。 

* 使用单例模式生成一个对象后，

* 该对象可以被其它众多对象所使用。 

*/

class Danli {



//保存类实例的静态成员变量

private static $_instance;



//private标记的构造方法

private function __construct(){

echo 'This is a Constructed method;';

}



//创建__clone方法防止对象被复制克隆

public function __clone(){

trigger_error('Clone is not allow!',E_USER_ERROR);

}



//单例方法,用于访问实例的公共的静态方法

public static function getInstance(){

if(!(self::$_instance instanceof self)){

self::$_instance = new self;

}

return self::$_instance;

}



public function test(){

echo '调用方法成功';

}



}



//用new实例化private标记构造函数的类会报错

//$danli = new Danli();



//正确方法,用双冒号::操作符访问静态方法获取实例

$danli = Danli::getInstance();

$danli-&gt;test();



//复制(克隆)对象将导致一个E_USER_ERROR

$danli_clone = clone $danli; 
</code></pre>
            
                </div>
            </div>
            <div class="pre-next">
                <li class="pre">上一篇：<a href="/blog/2015-09-21/PHPExcel.html">PHPExcel类库的各种使用方法总结</a></a></li>
                <li class="next">下一篇：<a href="/blog/2015-10-09/%E9%87%8D%E5%AE%9A%E5%90%91%E6%8F%92%E4%BB%B6.html">Firefox域名重定向插件——Mason</a></li>
            </div>
            <!-- 多说评论框 start -->
            <div class="ds-thread" data-thread-key="/blog/2015-10-09/PHP-singleton-pattern" data-title="PHP设计模式之单例模式" data-url="/blog/2015-10-09/PHP-singleton-pattern.html"></div>
            <!-- 多说评论框 end -->
        </div>
    </div>
    <div class="post-anchor">
        <div id="BlogAnchor">
            <h4>目录<a id="AnchorContentToggle" title="展开" style="cursor:pointer;">[<span>+</span>]</a></h4>
            <div class="AnchorContent" id="AnchorContent"></div>
        </div> 
    </div>
    <div style="clear:both;"></div>
    <script type="text/javascript" src="/public/js/post.js"></script>
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"gongvirgil"};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.unstable.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0] 
             || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
        </script>
    <!-- 多说公共JS代码 end -->

    
      </div>
      <!--Footer-->
      <div class="footer">
        <div class="footer-inner">
    <div class="footer_info">
        <div class="friendly-links">
            <span>友好链接</span>
        </div>
        <div class="site-info">
          <p>Copyright © 2012-2015 gongvirgil.github.io <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1256615808'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1256615808%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script></p>
        </div>
    </div>      
    <div class="tj"></div>
</div>
      </div>
      <!--Footer End-->
    </div>
    <!--Main End-->
    <div class="sitebar-toggle">
      <a id="sitebar-toggle-btn"><i class="fa fa-navicon"></i></a>
    </div>
    <div class="goTop" >
      <a title="回到顶部" id="goTop_btn"><i class="fa fa-chevron-up"></i></a>
    </div>

    <!-- 多说js加载开始，一个页面只需要加载一次 -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"gongvirgil"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = 'http://static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
  </body>
</html>
